<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Publikasi Bidang PPM - BAPPEDA</title>
    <link rel="stylesheet" href="css/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <style>
      /* Filter dan Pencarian */
      .filter-area {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin: 30px 0;
        gap: 20px;
      }
      .filter-select select,
      .search-box input {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 5px;
        font-size: 1em;
      }
      .filter-select {
        flex-grow: 1;
        max-width: 300px;
      }
      .search-box {
        flex-grow: 3;
        position: relative;
      }
      .search-box i {
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        color: #aaa;
      }
      .search-box input {
        width: 100%;
        padding-right: 40px;
      }

      /* Publikasi Card */
      .publication-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr); /* 3 kolom di desktop */
        gap: 30px;
        padding-bottom: 50px;
      }

      .publication-card {
        border: 1px solid #ddd;
        border-radius: 8px;
        overflow: hidden;
        background-color: white;
        transition: box-shadow 0.3s;
      }

      .publication-card:hover {
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .cover-placeholder {
        height: 200px;
        background-color: #f0f4f8; /* Warna latar belakang cover */
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        color: var(--primary-color);
        padding: 20px;
        font-weight: bold;
      }
      .cover-placeholder i {
        font-size: 3em;
        margin-bottom: 10px;
      }

      .card-content {
        padding: 15px;
      }
      .card-content h4 {
        color: var(--primary-color);
        margin-bottom: 5px;
        font-size: 1.1em;
      }
      .card-content .meta {
        font-size: 0.8em;
        color: #777;
        margin-bottom: 10px;
      }
      .card-content a.download-link {
        display: block;
        text-align: center;
        background-color: var(--secondary-color);
        color: var(--text-light);
        padding: 8px;
        border-radius: 5px;
        margin-top: 10px;
        transition: background-color 0.3s;
      }
      .card-content a.download-link:hover {
        background-color: #0056b3;
      }

      @media (max-width: 992px) {
        .publication-grid {
          grid-template-columns: repeat(2, 1fr);
        }
        .filter-area {
          flex-direction: column;
          gap: 10px;
        }
        .filter-select {
          max-width: 100%;
          width: 100%;
        }
        .search-box {
          width: 100%;
        }
      }
      @media (max-width: 600px) {
        .publication-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="container navbar">
        <div class="logo">
          <img src="assets/logo 1.png" alt="Logo Bappeda" />
        </div>
        <nav class="main-nav">
          <a href="index.html">BERANDA</a>
          <a href="profil.html">PROFIL</a>
          <a href="programkerja.html">PROGRAM KERJA</a>
          <a href="publikasi.html">PUBLIKASI</a>
          <a href="kontak.html">KONTAK</a>
        </nav>
        <div class="nav-extra">
          <button class="search-btn"><i class="fas fa-search"></i></button>
          <button class="menu-toggle"><i class="fas fa-bars"></i></button>
        </div>
      </div>
    </header>

    <section class="page-header">
      <div class="container">
        <h1>DOKUMEN & PUBLIKASI BIDANG PEMBANGUNAN MANUSIA</h1>
        <p>
          Akses dan unduh laporan, data, dan hasil kajian terkini terkait IPM,
          pendidikan, dan kesehatan.
        </p>
      </div>
    </section>

    <section class="container">
      <div class="filter-area">
        <div class="filter-select">
          <select id="type-filter">
            <option value="all">Filter Berdasarkan Jenis Dokumen</option>
          </select>
        </div>
        <div class="search-box">
          <input
            type="text"
            id="search-input"
            placeholder="Cari Judul Publikasi (mis: Stunting 2024)"
          />
          <i class="fas fa-search"></i>
        </div>
      </div>
    </section>

    <section class="container publication-grid" id="publication-list"></section>

    <footer class="footer">
      <div class="container footer-grid">
        <div class="footer-widget"><h3>HUBUNGI KAMI</h3></div>
        <div class="footer-widget"><h3>LINK TERKAIT</h3></div>
        <div class="footer-widget"><h3>PETA LOKASI</h3></div>
      </div>
      <div class="copyright">
        <div class="container">&copy; 2025 BAPPEDA.</div>
      </div>
    </footer>

    <script src="js/script.js"></script>
    <script src="js/filter-pencarian.js"></script>
    <script>
      const API_BASE = "http://localhost:5000/api";

      // Map untuk ikon dan teks cover berdasarkan jenis
      const typeMap = {
        ipm: { icon: "fa-chart-line", text: "Laporan IPM" },
        kesehatan: { icon: "fa-notes-medical", text: "Profil Kesehatan" },
        pendidikan: { icon: "fa-user-graduate", text: "Data Pendidikan" },
        rkpd: { icon: "fa-book-open", text: "Dokumen RKPD" },
      };

      // Fungsi untuk format tanggal
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("id-ID", {
          day: "2-digit",
          month: "short",
          year: "numeric",
        });
      }

      // Fungsi untuk render kartu publikasi
      function renderPublicationCard(pub) {
        const typeKey = pub.jenisDokumen.nama.toLowerCase().replace(/\s+/g, "");
        const typeInfo = typeMap[typeKey] || {
          icon: "fa-file",
          text: pub.jenisDokumen.nama,
        };
        const year = new Date(pub.tanggal).getFullYear();
        const card = document.createElement("div");
        card.className = "publication-card";
        card.setAttribute("data-type", typeKey);
        card.setAttribute("data-year", year);
        card.setAttribute("data-title", pub.judul);

        card.innerHTML = `
          <div class="cover-placeholder">
            <i class="fas ${typeInfo.icon}"></i>
            ${typeInfo.text} ${year}
          </div>
          <div class="card-content">
            <h4>${pub.judul}</h4>
            <p class="meta">Jenis: ${
              pub.jenisDokumen.nama
            } | Tanggal: ${formatDate(pub.tanggal)}</p>
            <p>${pub.deskripsi}</p>
            <a href="${pub.dokumenUrl}" target="_blank" class="download-link">
              <i class="fas fa-download"></i> Unduh Dokumen (PDF)
            </a>
          </div>
        `;
        return card;
      }

      // Fetch jenis dokumen dan populate select
      async function loadJenisDokumen() {
        try {
          const response = await fetch(`${API_BASE}/jenis-dokumen`);
          const data = await response.json();
          if (data.status === "success" && data.data) {
            const select = document.getElementById("type-filter");
            data.data.forEach((jd) => {
              const option = document.createElement("option");
              option.value = jd.nama.toLowerCase().replace(/\s+/g, "");
              option.textContent = jd.nama;
              select.appendChild(option);
            });
          }
        } catch (error) {
          console.error("Error loading jenis dokumen:", error);
        }
      }

      // Fetch publikasi dan render
      async function loadPublikasi() {
        try {
          const response = await fetch(`${API_BASE}/publikasi`);
          const data = await response.json();
          if (data.status === "success" && data.data) {
            const container = document.getElementById("publication-list");
            container.innerHTML = "";
            data.data.forEach((pub) => {
              const card = renderPublicationCard(pub);
              container.appendChild(card);
            });
            // Panggil filter setelah publikasi dimuat
            if (window.applyFilter) {
              window.applyFilter();
            }
          }
        } catch (error) {
          console.error("Error loading publikasi:", error);
        }
      }

      // Load data saat DOM ready
      document.addEventListener("DOMContentLoaded", function () {
        loadJenisDokumen();
        loadPublikasi();
      });
    </script>
  </body>
</html>
