<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Berita & Kegiatan - BAPPEDA</title>
    <link rel="stylesheet" href="css/style.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css"
    />
    <style>
      .news-content {
        padding: 50px 0;
      }
      .news-header {
        text-align: center;
        margin-bottom: 40px;
      }
      .news-header h1 {
        color: var(--primary-color);
        margin-bottom: 10px;
      }
      .news-header p {
        color: #666;
        font-size: 1.1em;
      }

      /* Filter Section */
      .filter-section {
        background-color: #f8f9fa;
        padding: 30px 0;
        margin-bottom: 40px;
      }
      .filter-container {
        display: flex;
        justify-content: center;
        gap: 20px;
        flex-wrap: wrap;
      }
      .filter-group {
        display: flex;
        flex-direction: column;
        min-width: 200px;
      }
      .filter-group label {
        font-weight: bold;
        margin-bottom: 5px;
        color: var(--primary-color);
      }
      .filter-group select,
      .filter-group input {
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 1em;
      }

      /* News Grid */
      .news-full-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
        gap: 30px;
        margin-bottom: 50px;
      }
      .news-full-card {
        background-color: white;
        border-radius: 8px;
        overflow: hidden;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s, box-shadow 0.3s;
      }
      .news-full-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 5px 20px rgba(0, 0, 0, 0.15);
      }
      .news-image {
        height: 200px;
        overflow: hidden;
      }
      .news-image img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s;
      }
      .news-full-card:hover .news-image img {
        transform: scale(1.05);
      }
      .news-content-card {
        padding: 20px;
      }
      .news-meta {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
        font-size: 0.9em;
        color: #666;
      }
      .news-category {
        background-color: var(--secondary-color);
        color: white;
        padding: 3px 8px;
        border-radius: 12px;
        font-size: 0.8em;
        font-weight: bold;
      }
      .news-date {
        font-style: italic;
      }
      .news-content-card h3 {
        color: var(--primary-color);
        margin-bottom: 10px;
        font-size: 1.2em;
        line-height: 1.3;
      }
      .news-excerpt {
        color: #555;
        line-height: 1.6;
        margin-bottom: 15px;
      }
      .read-more {
        display: inline-block;
        color: var(--primary-color);
        text-decoration: none;
        font-weight: bold;
        transition: color 0.3s;
      }
      .read-more:hover {
        color: var(--secondary-color);
      }

      /* Pagination */
      .pagination {
        display: flex;
        justify-content: center;
        gap: 10px;
        margin-top: 40px;
      }
      .page-btn {
        padding: 10px 15px;
        border: 1px solid #ddd;
        background-color: white;
        color: var(--primary-color);
        text-decoration: none;
        border-radius: 5px;
        transition: all 0.3s;
      }
      .page-btn:hover,
      .page-btn.active {
        background-color: var(--primary-color);
        color: white;
        border-color: var(--primary-color);
      }

      /* Responsive */
      @media (max-width: 768px) {
        .filter-container {
          flex-direction: column;
          align-items: center;
        }
        .filter-group {
          min-width: 100%;
          max-width: 300px;
        }
        .news-full-grid {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <header class="header">
      <div class="container navbar">
        <div class="logo">
          <img src="assets/logo 1.png" alt="Logo Bappeda" />
        </div>
        <nav class="main-nav">
          <a href="index.html">BERANDA</a>
          <a href="profil.html">PROFIL</a>
          <a href="programkerja.html">PROGRAM KERJA</a>
          <a href="publikasi.html">PUBLIKASI</a>
          <a href="kontak.html">KONTAK</a>
        </nav>
        <div class="nav-extra">
          <button class="search-btn"><i class="fas fa-search"></i></button>
          <button class="menu-toggle"><i class="fas fa-bars"></i></button>
        </div>
      </div>
    </header>

    <section class="page-header">
      <div class="container">
        <h1>BERITA & KEGIATAN</h1>
        <p>Informasi terkini tentang kegiatan dan program BAPPEDA Bidang PPM</p>
      </div>
    </section>

    <section class="filter-section">
      <div class="container">
        <div class="filter-container">
          <div class="filter-group">
            <label for="category-filter">Kategori</label>
            <select id="category-filter">
              <option value="all">Semua Kategori</option>
              <option value="berita">Berita</option>
              <option value="kegiatan">Kegiatan</option>
              <option value="pengumuman">Pengumuman</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="year-filter">Tahun</label>
            <select id="year-filter">
              <option value="all">Semua Tahun</option>
              <option value="2025">2025</option>
              <option value="2024">2024</option>
              <option value="2023">2023</option>
            </select>
          </div>
          <div class="filter-group">
            <label for="search-input">Cari Berita</label>
            <input type="text" id="search-input" placeholder="Kata kunci..." />
          </div>
        </div>
      </div>
    </section>

    <section class="container news-content">
      <div class="news-full-grid" id="news-container">
        <!-- News cards will be loaded here -->
      </div>

      <div class="pagination" id="pagination">
        <!-- Pagination will be generated here -->
      </div>
    </section>

    <footer class="footer">
      <div class="container footer-grid">
        <div class="footer-widget">
          <h3>HUBUNGI KAMI</h3>
          <p>
            Komplek Kantor Bupati Kutai Kartanegara Jl. Wolter Monginsidi No.1
            Kelurahan Timbau
          </p>
          <p>(0541) 664784</p>
          <p>Email:bappeda@kukarkab.go.id</p>
        </div>
        <div class="footer-widget">
          <h3>LINK TERKAIT</h3>
          <ul>
            <li><a href="#">e-Musrenbang</a></li>
            <li><a href="#">Pemerintah Daerah</a></li>
            <li><a href="#">Sistem Informasi</a></li>
          </ul>
        </div>
        <div class="footer-widget">
          <h3>PETA LOKASI</h3>
          <div class="map-container">
            <iframe
              src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d15957.568471465942!2d117.026118!3d-0.457816!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x2df67e9b3d1b6e49%3A0x868b8e8b0b92f70b!2sKantor%20Bappeda%20Kaltim!5e0!3m2!1sen!2sid!4v1700000000000!5m2!1sen!2sid"
              allowfullscreen=""
              loading="lazy"
              referrerpolicy="no-referrer-when-downgrade"
            ></iframe>
          </div>
        </div>
      </div>
      <div class="copyright">
        <div class="container">
          &copy; 2025 BAPPEDA. Hak Cipta Dilindungi Undang-Undang.
        </div>
      </div>
    </footer>

    <script>
      const API_BASE = "http://localhost:5000/api";
      let allNews = [];
      let filteredNews = [];
      let currentPage = 1;
      const itemsPerPage = 9;

      // Load news from backend
      async function loadNews() {
        try {
          // Load both kegiatan and publikasi as "news"
          const [kegiatanResponse, publikasiResponse] = await Promise.all([
            fetch(`${API_BASE}/kegiatan`),
            fetch(`${API_BASE}/publikasi`),
          ]);

          const kegiatanData = kegiatanResponse.ok
            ? await kegiatanResponse.json()
            : { data: [] };
          const publikasiData = publikasiResponse.ok
            ? await publikasiResponse.json()
            : { data: [] };

          // Transform kegiatan data to news format
          const kegiatanNews = kegiatanData.data.map((item) => ({
            id: item.id,
            type: "kegiatan",
            title: item.judul,
            content: item.description,
            date: item.tanggal,
            category: item.kategori,
            image: item.image,
            year: new Date(item.tanggal).getFullYear(),
          }));

          // Transform publikasi data to news format
          const publikasiNews = publikasiData.data.map((item) => ({
            id: item.id,
            type: "publikasi",
            title: item.judul,
            content: item.description,
            date: item.tanggal,
            category: "publikasi",
            image: null, // publikasi might not have images
            year: new Date(item.tanggal).getFullYear(),
          }));

          allNews = [...kegiatanNews, ...publikasiNews].sort(
            (a, b) => new Date(b.date) - new Date(a.date)
          );
          filteredNews = [...allNews];
          renderNews();
          renderPagination();
        } catch (error) {
          console.error("Error loading news:", error);
          // Fallback to static data if API fails
          loadStaticNews();
        }
      }

      // Fallback static news data
      function loadStaticNews() {
        allNews = [
          {
            id: 1,
            type: "berita",
            title: "Rapat Koordinasi Penyusunan RPJMD",
            content:
              "BAPPEDA mengadakan rapat koordinasi dengan stakeholder terkait penyusunan Rencana Pembangunan Jangka Menengah Daerah (RPJMD) tahun 2025-2029.",
            date: "2025-09-12",
            category: "berita",
            image: "assets/1.jpg",
            year: 2025,
          },
          {
            id: 2,
            type: "kegiatan",
            title: "Sosialisasi Perda Tata Ruang Terbaru",
            content:
              "Sosialisasi Peraturan Daerah tentang Tata Ruang Wilayah Kabupaten Kutai Kartanegara kepada masyarakat dan stakeholder.",
            date: "2025-07-31",
            category: "kegiatan",
            image: "assets/2.jpg",
            year: 2025,
          },
          {
            id: 3,
            type: "berita",
            title: "Pelatihan Kapasitas SDM Perencanaan",
            content:
              "Program pelatihan untuk meningkatkan kapasitas Sumber Daya Manusia di bidang perencanaan pembangunan daerah.",
            date: "2025-09-29",
            category: "berita",
            image: "assets/3.jpg",
            year: 2025,
          },
        ];
        filteredNews = [...allNews];
        renderNews();
        renderPagination();
      }

      // Render news cards
      function renderNews() {
        const container = document.getElementById("news-container");
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const newsToShow = filteredNews.slice(startIndex, endIndex);

        container.innerHTML = "";

        if (newsToShow.length === 0) {
          container.innerHTML =
            '<div class="no-news">Tidak ada berita yang ditemukan.</div>';
          return;
        }

        newsToShow.forEach((news) => {
          const newsCard = document.createElement("div");
          newsCard.className = "news-full-card";
          newsCard.innerHTML = `
            <div class="news-image">
              <img src="${news.image || "assets/placeholder.jpg"}" alt="${
            news.title
          }" />
            </div>
            <div class="news-content-card">
              <div class="news-meta">
                <span class="news-category">${news.category}</span>
                <span class="news-date">${formatDate(news.date)}</span>
              </div>
              <h3>${news.title}</h3>
              <p class="news-excerpt">${truncateText(news.content, 150)}</p>
              <a href="#" class="read-more" onclick="viewNewsDetail(${
                news.id
              }, '${news.type}')">
                Baca Selengkapnya <i class="fas fa-arrow-right"></i>
              </a>
            </div>
          `;
          container.appendChild(newsCard);
        });
      }

      // Render pagination
      function renderPagination() {
        const pagination = document.getElementById("pagination");
        const totalPages = Math.ceil(filteredNews.length / itemsPerPage);

        if (totalPages <= 1) {
          pagination.innerHTML = "";
          return;
        }

        let paginationHTML = "";

        // Previous button
        if (currentPage > 1) {
          paginationHTML += `<a href="#" class="page-btn" onclick="changePage(${
            currentPage - 1
          })">&laquo; Sebelumnya</a>`;
        }

        // Page numbers
        for (let i = 1; i <= totalPages; i++) {
          if (i === currentPage) {
            paginationHTML += `<span class="page-btn active">${i}</span>`;
          } else {
            paginationHTML += `<a href="#" class="page-btn" onclick="changePage(${i})">${i}</a>`;
          }
        }

        // Next button
        if (currentPage < totalPages) {
          paginationHTML += `<a href="#" class="page-btn" onclick="changePage(${
            currentPage + 1
          })">Selanjutnya &raquo;</a>`;
        }

        pagination.innerHTML = paginationHTML;
      }

      // Change page
      function changePage(page) {
        currentPage = page;
        renderNews();
        renderPagination();
        window.scrollTo({ top: 0, behavior: "smooth" });
      }

      // Filter news
      function filterNews() {
        const categoryFilter = document.getElementById("category-filter").value;
        const yearFilter = document.getElementById("year-filter").value;
        const searchTerm = document
          .getElementById("search-input")
          .value.toLowerCase();

        filteredNews = allNews.filter((news) => {
          const categoryMatch =
            categoryFilter === "all" || news.category === categoryFilter;
          const yearMatch =
            yearFilter === "all" || news.year.toString() === yearFilter;
          const searchMatch =
            news.title.toLowerCase().includes(searchTerm) ||
            news.content.toLowerCase().includes(searchTerm);

          return categoryMatch && yearMatch && searchMatch;
        });

        currentPage = 1;
        renderNews();
        renderPagination();
      }

      // View news detail (placeholder)
      function viewNewsDetail(id, type) {
        // This would typically navigate to a detail page
        alert(`Melihat detail ${type} dengan ID: ${id}`);
      }

      // Utility functions
      function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString("id-ID", {
          year: "numeric",
          month: "long",
          day: "numeric",
        });
      }

      function truncateText(text, maxLength) {
        if (text.length <= maxLength) return text;
        return text.substr(0, maxLength) + "...";
      }

      // Event listeners
      document
        .getElementById("category-filter")
        .addEventListener("change", filterNews);
      document
        .getElementById("year-filter")
        .addEventListener("change", filterNews);
      document
        .getElementById("search-input")
        .addEventListener("input", filterNews);

      // Load news on page load
      document.addEventListener("DOMContentLoaded", loadNews);
    </script>
  </body>
</html>
